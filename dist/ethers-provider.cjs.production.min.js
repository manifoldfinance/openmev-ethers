"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@ethersproject/web"),t=require("@ethersproject/keccak256"),r=require("@ethersproject/providers"),n=require("@ethersproject/bignumber"),o=require("@ethersproject/transactions"),i=require("@ethersproject/strings");function a(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function u(e){a(i,n,o,u,c,"next",e)}function c(e){a(i,n,o,u,c,"throw",e)}u(void 0)}))}}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return f(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h,p,d,v,g=(function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=Object.create((t&&t.prototype instanceof l?t:l).prototype),i=new E(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=x(a,r);if(u){if(u===f)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=s(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,i),o}function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var f={};function l(){}function h(){}function p(){}var d={};u(d,o,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(N([])));g&&g!==t&&r.call(g,o)&&(d=g);var m=p.prototype=l.prototype=Object.create(d);function y(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(o,i){function a(){return new t((function(n,a){!function n(o,i,a,u){var c=s(e[o],e,i);if("throw"!==c.type){var f=c.arg,l=f.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,u)}),(function(e){n("throw",e,a,u)})):t.resolve(l).then((function(e){f.value=e,a(f)}),(function(e){return n("throw",e,a,u)}))}u(c.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function x(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=s(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function N(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:_}}function _(){return{value:void 0,done:!0}}return h.prototype=p,u(m,"constructor",p),u(p,"constructor",h),h.displayName=u(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,u(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(b.prototype),u(b.prototype,i,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(m),u(m,a,"Generator"),u(m,o,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=N,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:N(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(h={exports:{}}),h.exports);function m(e){return t.keccak256(i.toUtf8Bytes(e))}!function(e){e[e.CONFIG_MINER_RELAY=0]="CONFIG_MINER_RELAY",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(p||(p={})),function(e){e[e.BATCH_BUNDLER=0]="BATCH_BUNDLER",e[e.KDB=1]="KDB",e[e.UNREC=2]="UNREC"}(d||(d={})),function(e){e[e.BundleIncluded=0]="BundleIncluded",e[e.BlockPassedWithoutInclusion=1]="BlockPassedWithoutInclusion",e[e.AccountNonceTooHigh=2]="AccountNonceTooHigh"}(v||(v={}));var y=function(r){var i,a;function f(e,t,n,o){var i;return(i=r.call(this,n,o)||this).genericProvider=e,i.authSigner=t,i.connectionInfo=n,i}a=r,(i=f).prototype=Object.create(a.prototype),i.prototype.constructor=i,s(i,a),f.throttleCallback=function(){var e=u(g.mark((function e(){return g.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("🆘 Warning: Rate limited"),e.abrupt("return",!1);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f.create=function(){var e=u(g.mark((function e(t,r,n,o){var i,a;return g.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(i="string"==typeof n||void 0===n?{url:n||"https://api.openmev.net:10001/v1/public/provider"}:c({},n)).headers&&(i.headers={}),i.throttleCallback=f.throttleCallback,a={chainId:0,name:""},"string"==typeof o?a.name=o:"number"==typeof o?a.chainId=o:"object"==typeof o&&(a.name=o.name,a.chainId=o.chainId),0!==a.chainId){e.next=9;break}return e.next=8,t.getNetwork();case 8:a.chainId=e.sent.chainId;case 9:return e.abrupt("return",new f(t,r,i,a));case 10:case"end":return e.stop()}}),e)})));return function(t,r,n,o){return e.apply(this,arguments)}}(),f.getMaxBaseFeeInFutureBlock=function(e,t){for(var r=n.BigNumber.from(e),o=0;o<t;o++)r=r.mul(1125).div(1e3).add(1);return r};var h=f.prototype;return h.sendRawBundle=function(){var e=u(g.mark((function e(r,n,i){var a,u,c,s,f=this;return g.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={txs:r,blockNumber:"0x"+n.toString(16),minTimestamp:null==i?void 0:i.minTimestamp,maxTimestamp:null==i?void 0:i.maxTimestamp,revertingTxHashes:null==i?void 0:i.revertingTxHashes},u=JSON.stringify(this.prepareBundleRequest("eth_sendBundle",[a])),e.next=4,this.request(u);case 4:if(null==(c=e.sent).error){e.next=7;break}return e.abrupt("return",{error:{message:c.error.message,code:c.error.code}});case 7:return s=r.map((function(e){var r=o.parse(e);return{signedTransaction:e,hash:t.keccak256(e),account:r.from||"0x0",nonce:r.nonce}})),e.abrupt("return",{bundleTransactions:s,wait:function(){return f.wait(s,n,3e5)},simulate:function(){return f.simulate(s.map((function(e){return e.signedTransaction})),n,void 0,null==i?void 0:i.minTimestamp)},receipts:function(){return f.fetchReceipts(s)}});case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),h.sendBundle=function(){var e=u(g.mark((function e(t,r,n){return g.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signBundle(t);case 2:return e.abrupt("return",this.sendRawBundle(e.sent,r,n));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),h.signBundle=function(){var e=u(g.mark((function e(t){var r,i,a,u,s,f,h,p,d;return g.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={},i=new Array,a=l(t);case 3:if((u=a()).done){e.next=47;break}if(!("signedTransaction"in(s=u.value))){e.next=13;break}if(void 0!==(f=o.parse(s.signedTransaction)).from){e.next=9;break}throw new Error("❌ Error: unable to decode signed transaction");case 9:return console.log(Error),r[f.from]=n.BigNumber.from(f.nonce+1),i.push(s.signedTransaction),e.abrupt("continue",45);case 13:return h=c({},s.transaction),e.next=16,s.signer.getAddress();case 16:if(p=e.sent,"string"!=typeof h.nonce){e.next=19;break}throw new Error("❌ Error: Bad nonce");case 19:if(console.log(Error),void 0===h.nonce){e.next=24;break}e.t0=n.BigNumber.from(h.nonce),e.next=32;break;case 24:if(e.t1=r[p],e.t1){e.next=31;break}return e.t2=n.BigNumber,e.next=29,this.genericProvider.getTransactionCount(p,"latest");case 29:e.t3=e.sent,e.t1=e.t2.from.call(e.t2,e.t3);case 31:e.t0=e.t1;case 32:if(r[p]=(d=e.t0).add(1),void 0===h.nonce&&(h.nonce=d),null!=h.type&&0!=h.type||void 0!==h.gasPrice||(h.gasPrice=n.BigNumber.from(0)),void 0!==h.gasLimit){e.next=40;break}return e.next=39,s.signer.estimateGas(h);case 39:h.gasLimit=e.sent;case 40:return e.t4=i,e.next=43,s.signer.signTransaction(h);case 43:e.t5=e.sent,e.t4.push.call(e.t4,e.t5);case 45:e.next=3;break;case 47:return e.abrupt("return",i);case 48:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),h.wait=function(e,t,r){var n=this;return new Promise((function(o,i){var a=null,c=!1,s=e.reduce((function(e,t){return t.nonce>0&&(t.nonce||0)<e[t.account]&&(e[t.account]=t.nonce),e[t.account]=t.nonce,e}),{}),f=function(){var r=u(g.mark((function r(i){var h,p,d,m;return g.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i<t)){r.next=10;break}return r.next=3,Promise.all(Object.entries(s).map(function(){var e=u(g.mark((function e(t){var r,o;return g.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t[0],o=t[1],e.next=3,n.genericProvider.getTransactionCount(r);case 3:return e.abrupt("return",o>=e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:if(!r.sent.every(Boolean)){r.next=7;break}return r.abrupt("return");case 7:o(v.AccountNonceTooHigh),r.next=17;break;case 10:return r.next=12,n.genericProvider.getBlock(t);case 12:for(h={},p=l(r.sent.transactions);!(d=p()).done;)h[d.value]=!0;m=e.every((function(e){return h[e.hash]})),o(m?v.BundleIncluded:v.BlockPassedWithoutInclusion);case 17:if(a&&clearTimeout(a),!c){r.next=20;break}return r.abrupt("return");case 20:c=!0,n.genericProvider.removeListener("block",f);case 22:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();n.genericProvider.on("block",f),"number"==typeof r&&r>0&&(a=setTimeout((function(){c||(a=null,c=!0,n.genericProvider.removeListener("block",f),i("❌ Rejected: Timed out"),console.log(i))}),r)).unref&&a.unref()}))},h.getUserStats=function(){var e=u(g.mark((function e(){var t,r,n;return g.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.genericProvider.getBlock("latest");case 2:return t="0x"+e.sent.number.toString(16),r=JSON.stringify(this.prepareBundleRequest("flashbots_getUserStats",[t])),e.next=8,this.request(r);case 8:if(null==(n=e.sent).error){e.next=11;break}return e.abrupt("return",{error:{message:n.error.message,code:n.error.code}});case 11:return e.abrupt("return",n.result);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),h.getBundleStats=function(){var e=u(g.mark((function e(t,r){var n,o,i;return g.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="0x"+r.toString(16),o=JSON.stringify(this.prepareBundleRequest("flashbots_getBundleStats",[{bundleHash:t,blockNumber:n}])),e.next=5,this.request(o);case 5:if(null==(i=e.sent).error){e.next=8;break}return e.abrupt("return",{error:{message:i.error.message,code:i.error.code}});case 8:return e.abrupt("return",i.result);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),h.simulate=function(){var e=u(g.mark((function e(t,r,o,i){var a,u,c,s,f,l;return g.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("number"!=typeof r){e.next=4;break}a="0x"+r.toString(16),e.next=16;break;case 4:return e.next=6,this.genericProvider.getBlock(r);case 6:if(null===(u=e.sent)){e.next=11;break}e.t0=u,e.next=14;break;case 11:return e.next=13,this.genericProvider.getBlock("latest");case 13:e.t0=e.sent;case 14:a="0x"+e.t0.number.toString(16);case 16:return c="number"==typeof o?"0x"+o.toString(16):o||"latest",s=JSON.stringify(this.prepareBundleRequest("eth_callBundle",[{txs:t,blockNumber:a,stateBlockNumber:c,timestamp:i}])),e.next=21,this.request(s);case 21:if(null==(f=e.sent).error){e.next=24;break}return e.abrupt("return",{error:{message:f.error.message,code:f.error.code}});case 24:return e.abrupt("return",{bundleHash:(l=f.result).bundleHash,coinbaseDiff:n.BigNumber.from(l.coinbaseDiff),results:l.results,totalGasUsed:l.results.reduce((function(e,t){return e+t.gasUsed}),0),firstRevert:l.results.find((function(e){return"revert"in e}))});case 26:case"end":return e.stop()}}),e,this)})));return function(t,r,n,o){return e.apply(this,arguments)}}(),h.request=function(){var t=u(g.mark((function t(r){var n;return g.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=c({},this.connectionInfo),t.t0=c,t.next=4,this.authSigner.getAddress();case 4:return t.t1=t.sent,t.t2=t.t1+":",t.next=8,this.authSigner.signMessage(m(r));case 8:return t.t3=t.sent,t.t4=t.t2+t.t3,t.t5={"X-Flashbots-Signature":t.t4},t.t6=this.connectionInfo.headers,n.headers=(0,t.t0)(t.t5,t.t6),t.abrupt("return",e.fetchJson(n,r));case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),h.fetchReceipts=function(){var e=u(g.mark((function e(t){var r=this;return g.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return r.genericProvider.getTransactionReceipt(e.hash)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h.prepareBundleRequest=function(e,t){return{method:e,params:t,id:this._nextId++,jsonrpc:"2.0"}},f}(r.JsonRpcProvider);exports.default={__proto__:null,id:m,DEFAULT_FLASHBOTS_ENDPOINT:"https://relay.flashbots.net",DEFAULT_ETHERMINE_ENDPOINT:"https://mev-relay.ethermine.org/",DEFAULT_OPENMEV_ENDPOINT_PROVIDER:"https://api.openmev.net:10001/v1/public/provider",get SystemConfigId(){return p},systemConfigIdFromJSON:function(e){switch(e){case 0:case"CONFIG_MINER_RELAY":return p.CONFIG_MINER_RELAY;case-1:case"UNRECOGNIZED":default:return p.UNRECOGNIZED}},systemConfigIdToJSON:function(e){switch(e){case p.CONFIG_MINER_RELAY:return"CONFIG_MINER_RELAY";default:return"UNKNOWN"}},get BundleSourceId(){return d},get FlashbotsBundleResolution(){return v},FlashbotsBundleProvider:y};
//# sourceMappingURL=ethers-provider.cjs.production.min.js.map
